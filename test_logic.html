<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feature Test - 202602 Hot Spring</title>
    <style>
        body { font-family: sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
        .test { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
        .pass { background-color: #d4edda; border-color: #c3e6cb; }
        .fail { background-color: #f8d7da; border-color: #f5c6cb; }
        h2 { color: #333; }
        code { background: #f4f4f4; padding: 2px 6px; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>202602 Hot Spring - Feature Tests</h1>
    
    <div id="test-results"></div>

    <script>
        // Copy the relevant functions from the main app for testing
        const tabs = [
            { id: 'day1', label: '2/1 Day 1', icon: 'sunset', date: '2026-02-01' },
            { id: 'day2', label: '2/2 Day 2', icon: 'coffee', date: '2026-02-02' },
            { id: 'day3', label: '2/3 Day 3', icon: 'trees', date: '2026-02-03' },
            { id: 'info', label: '資訊', icon: 'info', date: null }
        ];

        function getCurrentTabBasedOnDateTime() {
            const now = new Date();
            const currentDate = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            
            for (const tab of tabs) {
                if (tab.date) {
                    const tabDate = new Date(tab.date);
                    if (currentDate.getTime() === tabDate.getTime()) {
                        return tab.id;
                    }
                }
            }
            
            const firstDay = new Date('2026-02-01');
            if (currentDate < firstDay) {
                return 'day1';
            }
            
            const lastDay = new Date('2026-02-03');
            if (currentDate > lastDay) {
                return 'day3';
            }
            
            return 'day1';
        }

        function isEventExpired(dayId, eventTime) {
            const now = new Date();
            const currentDate = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            
            const tab = tabs.find(t => t.id === dayId);
            if (!tab || !tab.date) return false;
            
            const eventDate = new Date(tab.date);
            
            if (eventDate < currentDate) {
                return true;
            }
            
            if (eventDate.getTime() === currentDate.getTime()) {
                const timeMatch = eventTime.match(/(\d{1,2}):(\d{2})/);
                if (timeMatch) {
                    const eventHour = parseInt(timeMatch[1]);
                    const eventMinute = parseInt(timeMatch[2]);
                    const eventDateTime = new Date(now);
                    eventDateTime.setHours(eventHour, eventMinute, 0, 0);
                    
                    return now > eventDateTime;
                }
            }
            
            return false;
        }

        // Run tests
        const results = document.getElementById('test-results');
        const tests = [];

        // Test 1: Tab labels contain dates
        tests.push({
            name: 'Tab labels contain dates and index',
            condition: tabs[0].label === '2/1 Day 1' && 
                       tabs[1].label === '2/2 Day 2' && 
                       tabs[2].label === '2/3 Day 3',
            details: `Labels: ${tabs.map(t => t.label).join(', ')}`
        });

        // Test 2: Tabs have date attributes
        tests.push({
            name: 'Tabs have date attributes',
            condition: tabs[0].date === '2026-02-01' && 
                       tabs[1].date === '2026-02-02' && 
                       tabs[2].date === '2026-02-03',
            details: `Dates: ${tabs.slice(0,3).map(t => t.date).join(', ')}`
        });

        // Test 3: Auto tab selection function exists
        tests.push({
            name: 'Auto tab selection function works',
            condition: typeof getCurrentTabBasedOnDateTime === 'function',
            details: `Current date: ${new Date().toDateString()}, Selected tab: ${getCurrentTabBasedOnDateTime()}`
        });

        // Test 4: Event expiration logic (simulated)
        const testExpired = isEventExpired('day1', '09:00');
        tests.push({
            name: 'Event expiration logic works',
            condition: typeof isEventExpired === 'function',
            details: `isEventExpired('day1', '09:00') = ${testExpired} (depends on current date/time)`
        });

        // Test 5: Current tab for today
        const currentTab = getCurrentTabBasedOnDateTime();
        const today = new Date();
        tests.push({
            name: 'Auto-switches to appropriate tab',
            condition: ['day1', 'day2', 'day3'].includes(currentTab),
            details: `Today: ${today.toLocaleDateString()}, Auto-selected tab: ${currentTab}`
        });

        // Display results
        tests.forEach((test, index) => {
            const div = document.createElement('div');
            div.className = `test ${test.condition ? 'pass' : 'fail'}`;
            div.innerHTML = `
                <h3>Test ${index + 1}: ${test.name}</h3>
                <p><strong>Status:</strong> ${test.condition ? '✅ PASS' : '❌ FAIL'}</p>
                <p><strong>Details:</strong> ${test.details}</p>
            `;
            results.appendChild(div);
        });

        // Summary
        const passed = tests.filter(t => t.condition).length;
        const summary = document.createElement('div');
        summary.className = 'test';
        summary.style.fontWeight = 'bold';
        summary.style.fontSize = '1.2em';
        summary.innerHTML = `
            <h2>Summary</h2>
            <p>${passed} out of ${tests.length} tests passed</p>
        `;
        results.insertBefore(summary, results.firstChild);
    </script>
</body>
</html>
