<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>墾丁四重溪舒壓三日遊</title>

    <!-- Meta Tags for SEO & OG -->
    <meta name="description" content="2026/2/1 ~ 2026/2/3 墾丁四重溪溫泉舒壓之旅，包含看海美術館、落山風藝術季與雙流森林步道。">
    <meta property="og:title" content="墾丁四重溪舒壓三日遊 2026/2/1-2/3">
    <meta property="og:description" content="2/1 看海藝術季 | 2/2 溫泉Chill | 2/3 森林浴">
    <meta property="og:image"
        content="https://images.unsplash.com/photo-1519046904884-53103b34b206?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80">
    <meta property="og:type" content="website">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap"
        rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'Noto Sans TC', 'sans-serif'],
                    },
                    colors: {
                        primary: '#0d9488', // Teal-600
                        secondary: '#f0fdfa', // Teal-50
                    }
                }
            }
        }
    </script>

    <!-- Vue 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        /* Custom Scrollbar Hide for cleaner UI */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* Modal Transition */
        .fade-enter-active,
        .fade-leave-active {
            transition: opacity 0.3s ease;
        }

        .fade-enter-from,
        .fade-leave-to {
            opacity: 0;
        }

        .slide-up-enter-active,
        .slide-up-leave-active {
            transition: transform 0.3s ease-out;
        }

        .slide-up-enter-from,
        .slide-up-leave-to {
            transform: translateY(100%);
        }

        /* Image Loading Skeleton Animation */
        .skeleton {
            background: linear-gradient(90deg, #e5e5e5 25%, #f0f0f0 50%, #e5e5e5 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }

        @keyframes loading {
            0% {
                background-position: 200% 0;
            }

            100% {
                background-position: -200% 0;
            }
        }

        /* Collapsed Card Expand Animation */
        .expand-enter-active,
        .expand-leave-active {
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .expand-enter-from,
        .expand-leave-to {
            max-height: 0;
            opacity: 0;
        }

        .expand-enter-to,
        .expand-leave-from {
            max-height: 500px;
            opacity: 1;
        }
    </style>
</head>

<body class="bg-stone-50 text-stone-800 font-sans antialiased overflow-hidden select-none">

    <div id="app" class="h-[100dvh] flex flex-col relative">

        <!-- Main Content Area (Scrollable) -->
        <main ref="mainContent" class="flex-1 overflow-y-auto pb-24 no-scrollbar scroll-smooth">

            <!-- Dynamic Hero Section -->
            <div class="relative h-64 w-full">
                <img :src="heroImage" class="w-full h-full object-cover transition-opacity duration-500"
                    alt="Hero Banner" @error="handleHeroError">
                <div class="absolute inset-0 bg-gradient-to-t from-stone-900/80 via-stone-900/30 to-transparent"></div>
                <div class="absolute bottom-4 left-4 right-4 text-white">
                    <div
                        class="inline-flex items-center space-x-1 bg-white/20 backdrop-blur-sm px-2 py-1 rounded-full text-xs font-medium mb-2">
                        <i data-lucide="calendar" class="w-3 h-3"></i>
                        <span>{{ currentData.date }}</span>
                    </div>
                    <h1 class="text-2xl font-bold leading-tight">{{ currentData.title }}</h1>
                    <p class="text-stone-200 text-sm mt-1 opacity-90">{{ currentData.subtitle }}</p>
                </div>
            </div>

            <!-- Itinerary Timeline -->
            <div v-if="currentTab !== 'info'" class="px-4 py-6 space-y-6">

                <!-- Timeline Connector Line (Visual only) -->
                <div class="absolute left-8 top-64 bottom-24 w-0.5 bg-stone-200 -z-10 hidden"></div>

                <div v-for="(item, index) in currentData.schedule" :key="item.id">

                    <!-- Collapsed View for Expired Events -->
                    <div v-if="isEventExpired(currentTab, item.time)"
                        class="bg-stone-100 rounded-xl shadow-sm border border-stone-200 overflow-hidden transition-all duration-300"
                        :class="isExpiredItemExpanded(item.id) ? 'opacity-100' : 'opacity-60 hover:opacity-80'">

                        <!-- Collapsed Header (Always Visible) -->
                        <div class="p-4 cursor-pointer active:bg-stone-200 transition-colors"
                            @click="toggleExpiredItem(item.id)">
                            <div class="flex items-center justify-between">
                                <div class="flex-1">
                                    <div class="flex items-center gap-2">
                                        <span class="text-xs font-bold text-stone-500 bg-stone-200 px-2 py-1 rounded">
                                            {{ item.time }}
                                        </span>
                                        <h3 class="font-medium text-stone-600">{{ item.title }}</h3>
                                    </div>
                                </div>
                                <div class="flex items-center gap-2">
                                    <i data-lucide="check-circle" class="w-5 h-5 text-stone-400"></i>
                                    <i data-lucide="chevron-down"
                                        class="w-5 h-5 text-stone-400 transition-transform duration-300"
                                        :class="isExpiredItemExpanded(item.id) ? 'rotate-180' : ''"></i>
                                </div>
                            </div>
                        </div>

                        <!-- Expanded Content (Toggleable) -->
                        <transition name="expand">
                            <div v-if="isExpiredItemExpanded(item.id)">
                                <!-- Card Image -->
                                <div class="h-40 w-full bg-stone-200 relative overflow-hidden">
                                    <img :src="item.image" class="w-full h-full object-cover" :alt="item.title"
                                        loading="lazy" @error="handleImageError">
                                </div>

                                <!-- Card Content -->
                                <div class="p-4 pt-3 bg-white">
                                    <p class="text-stone-500 text-sm leading-relaxed mb-3">
                                        {{ item.desc }}
                                    </p>

                                    <!-- Tags -->
                                    <div class="flex gap-2 mb-3">
                                        <span v-if="item.tags" v-for="tag in item.tags"
                                            class="text-xs bg-stone-100 text-stone-600 px-2 py-1 rounded-full">
                                            #{{ tag }}
                                        </span>
                                    </div>

                                    <!-- View Details Button -->
                                    <button @click.stop="openModal(item)"
                                        class="w-full bg-stone-200 hover:bg-stone-300 text-stone-700 font-medium py-2 px-4 rounded-lg transition-colors flex items-center justify-center gap-2">
                                        <i data-lucide="info" class="w-4 h-4"></i>
                                        查看詳細資訊
                                    </button>
                                </div>
                            </div>
                        </transition>
                    </div>

                    <!-- Full Card View for Current/Future Events -->
                    <div v-else
                        class="bg-white rounded-xl shadow-sm border border-stone-100 overflow-hidden active:scale-[0.98] transition-transform duration-200"
                        @click="openModal(item)">

                        <!-- Card Image -->
                        <div class="h-40 w-full bg-stone-200 relative overflow-hidden">
                            <img :src="item.image" class="w-full h-full object-cover" :alt="item.title" loading="lazy"
                                @error="handleImageError">
                            <div
                                class="absolute top-3 left-3 bg-white/90 backdrop-blur-md px-2 py-1 rounded-md text-xs font-bold text-stone-800 shadow-sm">
                                {{ item.time }}
                            </div>
                        </div>

                        <!-- Card Content -->
                        <div class="p-4">
                            <div class="flex justify-between items-start mb-2">
                                <h3 class="font-bold text-lg text-stone-800">{{ item.title }}</h3>
                                <i data-lucide="chevron-right" class="w-5 h-5 text-stone-400"></i>
                            </div>
                            <p class="text-stone-500 text-sm line-clamp-2 leading-relaxed">
                                {{ item.desc }}
                            </p>

                            <!-- Tags -->
                            <div class="flex gap-2 mt-3">
                                <span v-if="item.tags" v-for="tag in item.tags"
                                    class="text-xs bg-stone-100 text-stone-600 px-2 py-1 rounded-full">
                                    #{{ tag }}
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- End of Day Message -->
                <div class="text-center py-8 opacity-50">
                    <i data-lucide="moon" class="w-6 h-6 mx-auto mb-2 text-stone-400"></i>
                    <p class="text-sm text-stone-500">Day {{ currentData.dayNum }} 行程結束</p>
                </div>
            </div>

            <!-- Info Tab Content -->
            <div v-else class="px-4 py-6 space-y-6">
                <div class="bg-white p-5 rounded-xl shadow-sm border border-stone-100">
                    <h3 class="font-bold text-lg mb-4 flex items-center gap-2">
                        <i data-lucide="backpack" class="w-5 h-5 text-primary"></i>
                        行前準備
                    </h3>
                    <ul class="space-y-3 text-sm text-stone-600">
                        <li v-for="item in preparationItems" :key="item.id"
                            class="flex items-start gap-2 cursor-pointer hover:bg-stone-50 p-2 rounded-lg transition-colors"
                            role="checkbox" :aria-checked="item.checked" tabindex="0"
                            @click="toggleChecklistItem(item.id)" @keydown.enter="toggleChecklistItem(item.id)"
                            @keydown.space.prevent="toggleChecklistItem(item.id)">
                            <div class="shrink-0 mt-0.5">
                                <span class="w-4 h-4 flex items-center justify-center"
                                    :class="item.checked ? 'text-green-500' : 'text-stone-300'">
                                    <svg viewBox="0 0 24 24" class="w-4 h-4" fill="none" stroke="currentColor"
                                        stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                        aria-hidden="true">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <path d="m9 12 2 2 4-4" :class="item.checked ? 'opacity-100' : 'opacity-0'">
                                        </path>
                                    </svg>
                                </span>
                            </div>
                            <span :class="{ 'line-through text-stone-400': item.checked }">{{ item.text }}</span>
                        </li>
                    </ul>
                </div>

                <div class="bg-white p-5 rounded-xl shadow-sm border border-stone-100">
                    <h3 class="font-bold text-lg mb-4 flex items-center gap-2">
                        <i data-lucide="info" class="w-5 h-5 text-primary"></i>
                        官方資訊
                    </h3>
                    <div class="space-y-3">
                        <a href="https://www.amazing-pingtung.com/ptlsf" target="_blank"
                            class="flex items-center justify-between w-full bg-gradient-to-r from-primary to-teal-500 hover:from-teal-700 hover:to-teal-600 text-white font-bold py-3 px-4 rounded-lg transition-all shadow-md shadow-teal-200 active:scale-[0.98]">
                            <span class="flex items-center gap-2">
                                <i data-lucide="external-link" class="w-5 h-5"></i>
                                落山風藝術節
                            </span>
                            <i data-lucide="arrow-right" class="w-5 h-5"></i>
                        </a>
                        <a href="https://fun-pingtung.com/" target="_blank"
                            class="flex items-center justify-between w-full bg-gradient-to-r from-orange-500 to-amber-500 hover:from-orange-600 hover:to-amber-600 text-white font-bold py-3 px-4 rounded-lg transition-all shadow-md shadow-orange-200 active:scale-[0.98]">
                            <span class="flex items-center gap-2">
                                <i data-lucide="external-link" class="w-5 h-5"></i>
                                四重溪溫泉季
                            </span>
                            <i data-lucide="arrow-right" class="w-5 h-5"></i>
                        </a>
                    </div>
                </div>
            </div>

        </main>

        <!-- Bottom Navigation -->
        <nav
            class="fixed bottom-0 left-0 right-0 bg-white border-t border-stone-200 px-2 pb-safe pt-2 h-[80px] flex justify-around items-start z-40 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)]">
            <button v-for="tab in tabs" :key="tab.id" @click="currentTab = tab.id"
                class="flex flex-col items-center justify-center w-16 p-1 transition-all duration-300"
                :class="currentTab === tab.id ? 'text-primary' : 'text-stone-400 hover:text-stone-600'">
                <div class="mb-1 transition-transform duration-300"
                    :class="currentTab === tab.id ? '-translate-y-1' : ''">
                    <i :data-lucide="tab.icon" class="w-6 h-6"></i>
                </div>
                <span class="text-[10px] font-medium tracking-wide">{{ tab.label }}</span>
                <span class="w-1 h-1 rounded-full bg-primary mt-1 transition-opacity duration-300"
                    :class="currentTab === tab.id ? 'opacity-100' : 'opacity-0'"></span>
            </button>
        </nav>

        <!-- Detail Modal (Bottom Sheet Style) -->
        <transition name="fade">
            <div v-if="isModalOpen"
                class="fixed inset-0 bg-black/60 z-50 flex items-end sm:items-center justify-center backdrop-blur-sm"
                @click.self="closeModal">
                <transition name="slide-up" appear>
                    <div v-if="isModalOpen"
                        class="bg-white w-full sm:w-[90%] sm:max-w-md sm:rounded-2xl rounded-t-2xl h-[85vh] sm:h-[80vh] flex flex-col shadow-2xl overflow-hidden">

                        <!-- Modal Header Image -->
                        <div class="relative h-56 shrink-0 bg-stone-200">
                            <img :src="selectedSpot.image" class="w-full h-full object-cover" @error="handleImageError">
                            <button @click="closeModal"
                                class="absolute top-4 right-4 bg-black/30 hover:bg-black/50 text-white rounded-full p-2 backdrop-blur-md transition-colors">
                                <i data-lucide="x" class="w-5 h-5"></i>
                            </button>
                            <div
                                class="absolute bottom-0 left-0 right-0 p-5 bg-gradient-to-t from-white via-white/80 to-transparent pt-12">
                                <h2 class="text-2xl font-bold text-stone-900">{{ selectedSpot.title }}</h2>
                            </div>
                        </div>

                        <!-- Modal Body -->
                        <div class="flex-1 overflow-y-auto p-5 pt-0">
                            <!-- Meta Info -->
                            <div class="flex flex-wrap gap-3 mb-6 mt-2">
                                <div
                                    class="flex items-center text-xs font-medium bg-stone-100 px-3 py-1.5 rounded-full text-stone-600">
                                    <i data-lucide="clock" class="w-3.5 h-3.5 mr-1.5"></i>
                                    {{ selectedSpot.time }}
                                </div>
                                <div class="flex items-center text-xs font-medium bg-stone-100 px-3 py-1.5 rounded-full text-stone-600"
                                    v-if="selectedSpot.info.wear">
                                    <i data-lucide="shirt" class="w-3.5 h-3.5 mr-1.5"></i>
                                    {{ selectedSpot.info.wear }}
                                </div>
                                <div class="flex items-center text-xs font-medium bg-stone-100 px-3 py-1.5 rounded-full text-stone-600"
                                    v-if="selectedSpot.info.price">
                                    <i data-lucide="ticket" class="w-3.5 h-3.5 mr-1.5"></i>
                                    {{ selectedSpot.info.price }}
                                </div>
                            </div>

                            <!-- Description -->
                            <div class="prose prose-stone prose-sm mb-6">
                                <p class="text-stone-600 leading-relaxed text-base">{{ selectedSpot.desc }}</p>
                            </div>

                            <!-- Tips Section -->
                            <div v-if="selectedSpot.tips"
                                class="bg-yellow-50 border border-yellow-100 rounded-lg p-4 mb-6">
                                <h4 class="text-yellow-800 font-bold text-sm mb-2 flex items-center">
                                    <i data-lucide="lightbulb" class="w-4 h-4 mr-2"></i>
                                    貼心小撇步
                                </h4>
                                <p class="text-yellow-700 text-sm leading-relaxed">{{ selectedSpot.tips }}</p>
                            </div>

                        </div>

                        <!-- Modal Footer -->
                        <div class="p-4 border-t border-stone-100 bg-white pb-safe">
                            <a :href="googleMapLink" target="_blank"
                                class="flex items-center justify-center w-full bg-primary hover:bg-teal-700 text-white font-bold py-3.5 rounded-xl transition-colors shadow-md shadow-teal-200 active:scale-[0.98]">
                                <i data-lucide="map-pin" class="w-5 h-5 mr-2"></i>
                                導航前往
                            </a>
                        </div>
                    </div>
                </transition>
            </div>
        </transition>

    </div>

    <script>
        const { createApp, ref, computed, watch, nextTick, onMounted } = Vue;

        createApp({
            setup() {
                // --- State ---
                const currentTab = ref('day1');
                const mainContent = ref(null);
                const isModalOpen = ref(false);
                const selectedSpot = ref({});
                const expandedExpiredItems = ref(new Set());

                // Preparation items checklist state
                const preparationItems = ref([
                    { id: 'item-windproof', text: '落山風大，務必攜帶防風薄外套與帽子。', checked: false },
                    { id: 'item-swimsuit', text: '泳衣、泳帽（飯店大眾池與SPA需穿著）。', checked: false },
                    { id: 'item-shoes', text: '好走的鞋（雙流步道、看海美術館需步行）。', checked: false },
                    { id: 'item-sunscreen', text: '防曬乳與太陽眼鏡（海邊紫外線強）。', checked: false }
                ]);

                // --- Static Data ---
                const tabs = [
                    { id: 'day1', label: '2/1 Day 1', icon: 'sunset', date: '2026-02-01' },
                    { id: 'day2', label: '2/2 Day 2', icon: 'coffee', date: '2026-02-02' },
                    { id: 'day3', label: '2/3 Day 3', icon: 'trees', date: '2026-02-03' },
                    { id: 'info', label: '資訊', icon: 'info', date: null }
                ];

                const scheduleData = {
                    day1: {
                        dayNum: 1,
                        date: '2026/2/1 (六)',
                        title: '藝術季與海風',
                        subtitle: '看海美術館 · 落山風 · 四重溪',
                        heroImage: 'https://images.unsplash.com/photo-1507525428034-b723cf961d3e?auto=format&fit=crop&w=1200&q=80', // Ocean coast
                        schedule: [
                            {
                                id: 100,
                                time: '09:30',
                                title: '台南火車站接大昌',
                                location: '台南火車站',
                                image: 'https://images.unsplash.com/photo-1474487548417-781cb71495f3?auto=format&fit=crop&w=800&q=80', // Train station
                                desc: '在台南火車站接大昌，準備一起出發前往集合地點。',
                                tips: '記得：接大昌之前先去胖胖家接他。',
                                tags: ['接人'],
                                info: { wear: '輕便', price: '無' }
                            },
                            {
                                id: 101,
                                time: '10:00',
                                title: '仁德交流道集合',
                                location: '仁德交流道',
                                image: 'https://images.unsplash.com/photo-1469854523086-cc02fe5d8800?auto=format&fit=crop&w=800&q=80', // Road trip
                                desc: '集合出發，準備迎接美好的假期！',
                                tags: ['集合'],
                                info: { wear: '輕便', price: '無' }
                            },
                            {
                                id: 102,
                                time: '10:30',
                                title: '仁武烤鴨午餐',
                                location: '仁武烤鴨',
                                image: 'assets/images/renwu-roast-duck.jpg', // Local food
                                desc: '在地排隊名店，皮脆肉嫩的烤鴨，補充體力好上路。',
                                tags: ['午餐', '美食'],
                                info: { wear: '休閒', price: '約 $300/人' }
                            },
                            {
                                id: 103,
                                time: '13:00',
                                title: '看海美術館 & 落山風',
                                location: '看海美術館',
                                image: 'https://images.unsplash.com/photo-1507525428034-b723cf961d3e?auto=format&fit=crop&w=800&q=80', // Sea/Beach
                                desc: '前往海口港看海美術館，若適逢藝術季可欣賞海岸裝置藝術。在海邊拍照、喝飲料，感受國境之南的風。',
                                tips: '落山風季節風力極強，務必攜帶防風外套、帽子請戴穩，注意防曬。',
                                tags: ['拍照', '景點'],
                                info: { wear: '防風衣物', price: '免費/依展覽' }
                            },
                            {
                                id: 107,
                                time: '16:00',
                                title: '車城福安宮',
                                location: '車城福安宮',
                                image: 'https://images.unsplash.com/photo-1549880338-65ddcdfd017b?auto=format&fit=crop&w=800&q=80', // Temple
                                desc: '參觀車城福安宮，體驗在地廟宇文化與香火熱絡的氛圍。',
                                tags: ['文化', '景點'],
                                info: { wear: '輕便', price: '免費' }
                            },
                            {
                                id: 104,
                                time: '16:30',
                                title: '茴香戀戀溫泉會館 Check-in',
                                location: '茴香戀戀溫泉會館',
                                image: 'https://images.unsplash.com/photo-1631049307264-da0ec9d70304?auto=format&fit=crop&w=800&q=80', // Hotel spa
                                desc: '前往茴香戀戀溫泉會館辦理入住，稍作休息，採買零食飲料。',
                                tags: ['住宿', '休息'],
                                info: { wear: '輕鬆', price: '' }
                            },
                            {
                                id: 105,
                                time: '18:30',
                                title: '大山羊肉爐',
                                location: '大山羊肉爐',
                                image: 'https://images.unsplash.com/photo-1546069901-ba9599a7e63c?auto=format&fit=crop&w=800&q=80', // Hot pot
                                desc: '四重溪知名的羊肉爐，湯頭濃郁暖身。晚餐後可回飯店繼續泡湯、玩桌遊、小酌聊天。',
                                tips: '羊肉爐人氣很旺，可能需要排隊。',
                                tags: ['晚餐', '必吃'],
                                info: { wear: '休閒', price: '約 $500/人' }
                            },
                            {
                                id: 106,
                                time: '20:00',
                                title: '夜間泡湯 Chill',
                                location: '茴香戀戀溫泉會館',
                                image: 'https://images.unsplash.com/photo-1540555700478-4be289fbecef?auto=format&fit=crop&w=800&q=80', // Spa wellness
                                desc: '在房內浴池或飯店大眾池享受美人湯。若有溫泉季燈飾活動，可散步至溫泉公園夜拍。',
                                tags: ['溫泉', '放鬆'],
                                info: { wear: '泳衣(大眾池)', price: '含住宿' }
                            }
                        ]
                    },
                    day2: {
                        dayNum: 2,
                        date: '2026/2/2 (日)',
                        title: '溫泉鄉慢活',
                        subtitle: '自然醒 · 泡湯 · 散步',
                        heroImage: 'https://images.unsplash.com/photo-1544575814-65c3ea11abc5?auto=format&fit=crop&w=1200&q=80', // Spa relax
                        schedule: [
                            {
                                id: 201,
                                time: '09:00',
                                title: '睡到自然醒 & 早餐',
                                location: '四重溪',
                                image: 'https://images.unsplash.com/photo-1556909114-f6e7ad7d3136?auto=format&fit=crop&w=800&q=80', // Morning breakfast
                                desc: '享受沒有鬧鐘的早晨，吃完早餐後可以賴在房間繼續泡湯，或去公園煮溫泉蛋。',
                                tips: '這一天重點就是「懶」，不要趕行程。',
                                tags: ['早餐', '慢活'],
                                info: { wear: '睡衣/輕便', price: '住宿含' }
                            },
                            {
                                id: 211,
                                time: '12:30',
                                title: '邱家生魚片-旗艦總店',
                                location: '邱家生魚片-旗艦總店',
                                image: 'https://images.unsplash.com/photo-1553621042-f6e147245754?auto=format&fit=crop&w=800&q=80', // Sashimi
                                desc: '品嚐新鮮生魚片與在地海味，推薦多人共享幾種口味。',
                                tags: ['午餐', '海味'],
                                info: { wear: '休閒', price: '約 $300/人' }
                            },
                            {
                                id: 212,
                                time: '14:30',
                                title: '台灣最南點',
                                location: '台灣最南點',
                                image: 'https://images.unsplash.com/photo-1505765051536-67f6c6d6f8a0?auto=format&fit=crop&w=800&q=80', // Landmark
                                desc: '到台灣最南點拍照留念，欣賞海岸線與地標。',
                                tags: ['景點', '拍照'],
                                info: { wear: '輕便', price: '免費' }
                            },
                            {
                                id: 213,
                                time: '16:00',
                                title: '龍磐公園大草原',
                                location: '龍磐公園',
                                image: 'https://images.unsplash.com/photo-1501785888041-af3ef285b470?auto=format&fit=crop&w=800&q=80', // Grassland
                                desc: '在大草原漫步、看海與日落，適合拍照與放鬆。',
                                tags: ['景點', '散步'],
                                info: { wear: '舒適', price: '免費' }
                            },
                            {
                                id: 214,
                                time: '16:50',
                                title: '小觀山鹹粿',
                                location: '小觀山鹹粿',
                                image: 'https://images.unsplash.com/photo-1544025162-d76694265947?auto=format&fit=crop&w=800&q=80', // Snack
                                desc: '來份在地鹹粿當點心，體驗小吃文化。',
                                tags: ['點心', '小吃'],
                                info: { wear: '休閒', price: '自費' }
                            },
                            {
                                id: 215,
                                time: '17:30',
                                title: '山南咖啡',
                                location: '山南咖啡',
                                image: 'https://images.unsplash.com/photo-1505250469679-203ad9ced0cb?auto=format&fit=crop&w=800&q=80', // Cafe
                                desc: '在山南咖啡喝杯咖啡、稍作休息，準備晚上的活動。',
                                tags: ['咖啡', '下午茶'],
                                info: { wear: '休閒', price: '自費' }
                            },
                            {
                                id: 216,
                                time: '19:00',
                                title: '四重溪溫泉公園',
                                location: '四重溪溫泉公園',
                                image: 'https://images.unsplash.com/photo-1540555700478-4be289fbecef?auto=format&fit=crop&w=800&q=80', // Hot spring park
                                desc: '逛溫泉公園、欣賞夜間燈飾與溫泉氣息。',
                                tags: ['溫泉', '夜景'],
                                info: { wear: '輕鬆', price: '免費' }
                            },
                            {
                                id: 203,
                                time: '20:00',
                                title: '嚕嚕咪炸物',
                                location: '嚕嚕咪炸物',
                                image: 'https://images.unsplash.com/photo-1541542684-4b9b3f8f0dce?auto=format&fit=crop&w=800&q=80', // Fried food
                                desc: '在地人氣炸物小店，推薦招牌拼盤與炸物小食，適合多人分享。',
                                tips: '建議趁熱食用，也可以外帶回飯店享用。',
                                tags: ['晚餐', '小吃'],
                                info: { wear: '休閒', price: '約 $200/人' }
                            }
                            ,
                            {
                                id: 217,
                                time: '21:00',
                                title: '夜間泡湯 Chill',
                                location: '茴香戀戀溫泉會館',
                                image: 'https://images.unsplash.com/photo-1540555700478-4be289fbecef?auto=format&fit=crop&w=800&q=80', // Spa wellness
                                desc: '晚餐後返回飯店泡湯，放鬆身心，享受溫泉與夜景。',
                                tags: ['溫泉', '放鬆'],
                                info: { wear: '泳衣(大眾池)', price: '含住宿' }
                            }
                        ]
                    },
                    day3: {
                        dayNum: 3,
                        date: '2026/2/3 (一)',
                        title: '森林深呼吸',
                        subtitle: '雙流步道 · 萬巒豬腳 · 返家',
                        heroImage: 'https://images.unsplash.com/photo-1441974231531-c6227db76b6e?auto=format&fit=crop&w=1200&q=80', // Forest nature
                        schedule: [
                            {
                                id: 301,
                                time: '08:00',
                                title: '飯店早餐',
                                location: '茴香戀戀溫泉會館',
                                image: 'https://images.unsplash.com/photo-1504674900247-0877df9cc836?auto=format&fit=crop&w=800&q=80',
                                desc: '在飯店享用早餐，補充體力準備一天行程。',
                                tags: ['早餐'],
                                info: { wear: '輕便', price: '含住宿' }
                            },
                            {
                                id: 302,
                                time: '09:00',
                                title: '飯店泡湯 chill',
                                location: '茴香戀戀溫泉會館',
                                image: 'https://images.unsplash.com/photo-1540555700478-4be289fbecef?auto=format&fit=crop&w=800&q=80',
                                desc: '在飯店或公園溫泉放鬆泡湯，享受慢活時光。',
                                tags: ['溫泉', '放鬆'],
                                info: { wear: '泳衣(大眾池)', price: '含住宿' }
                            },
                            {
                                id: 303,
                                time: '11:00',
                                title: 'check-out',
                                location: '茴香戀戀溫泉會館',
                                image: 'https://images.unsplash.com/photo-1496417263034-38ec4f0b665a?auto=format&fit=crop&w=800&q=80',
                                desc: '辦理退房後準備當日行程。',
                                tags: ['退房'],
                                info: { wear: '休閒', price: '' }
                            },
                            {
                                id: 304,
                                time: '11:30',
                                title: '戰車公園',
                                location: '戰車公園',
                                image: 'https://images.unsplash.com/photo-1505765051536-67f6c6d6f8a0?auto=format&fit=crop&w=800&q=80',
                                desc: '參觀戰車展示與軍事主題公園，適合拍照與短暫遊覽。',
                                tags: ['景點', '博物館'],
                                info: { wear: '輕便', price: '免費' }
                            },
                            {
                                id: 305,
                                time: '12:00',
                                title: '曾家小棧',
                                location: '曾家小棧',
                                image: 'https://images.unsplash.com/photo-1528605248644-14dd04022da1?auto=format&fit=crop&w=800&q=80',
                                desc: '在地餐館用餐，推薦當地小吃與家常菜。',
                                tags: ['午餐', '在地'],
                                info: { wear: '休閒', price: '自費' }
                            },
                            {
                                id: 306,
                                time: '13:30',
                                title: '龜山步道',
                                location: '龜山步道',
                                image: 'https://images.unsplash.com/photo-1501785888041-af3ef285b470?auto=format&fit=crop&w=800&q=80',
                                desc: '短程登山步道，沿途景觀佳，適合散步與拍照。',
                                tags: ['健行', '自然'],
                                info: { wear: '運動鞋', price: '免費' }
                            },
                            {
                                id: 307,
                                time: '16:00',
                                title: '福灣巧克力',
                                location: '福灣巧克力',
                                image: 'https://images.unsplash.com/photo-1505250469679-203ad9ced0cb?auto=format&fit=crop&w=800&q=80',
                                desc: '參觀巧克力工廠與選購伴手禮，體驗甜點與工廠風情。',
                                tags: ['伴手禮', '甜點'],
                                info: { wear: '休閒', price: '參觀免費/購買自費' }
                            },
                            {
                                id: 308,
                                time: '18:00',
                                title: '俺の豚',
                                location: '俺の豚',
                                image: 'https://images.unsplash.com/photo-1541542684-4b9b3f8f0dce?auto=format&fit=crop&w=800&q=80',
                                desc: '晚餐於人氣豚肉料理店享用在地豬肉料理，畫下旅程完美句點。',
                                tags: ['晚餐'],
                                info: { wear: '休閒', price: '自費' }
                            }
                        ]
                    }
                };

                // --- Computed ---
                const currentData = computed(() => {
                    return scheduleData[currentTab.value] || scheduleData.day1;
                });

                const heroImage = computed(() => {
                    return currentData.value.heroImage;
                });

                const googleMapLink = computed(() => {
                    if (!selectedSpot.value.location) return '#';
                    return `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(selectedSpot.value.location)}`;
                });

                // --- Methods ---
                const openModal = (item) => {
                    selectedSpot.value = item;
                    isModalOpen.value = true;
                };

                const closeModal = () => {
                    isModalOpen.value = false;
                };

                const toggleExpiredItem = (itemId) => {
                    if (expandedExpiredItems.value.has(itemId)) {
                        expandedExpiredItems.value.delete(itemId);
                    } else {
                        expandedExpiredItems.value.add(itemId);
                    }
                    // Trigger reactivity
                    expandedExpiredItems.value = new Set(expandedExpiredItems.value);
                    // Refresh icons after DOM update
                    nextTick(() => refreshIcons());
                };

                const isExpiredItemExpanded = (itemId) => {
                    return expandedExpiredItems.value.has(itemId);
                };

                const handleImageError = (e) => {
                    // Fallback image in case Unsplash fails
                    e.target.src = 'https://dummyimage.com/800x600/e7e5e4/78716c.jpg&text=No+Image';
                };

                const handleHeroError = (e) => {
                    e.target.src = 'https://dummyimage.com/1000x800/2d2d2d/fff.jpg&text=Travel';
                };

                const refreshIcons = () => {
                    // Slight delay to ensure DOM is ready
                    setTimeout(() => {
                        if (window.lucide) {
                            window.lucide.createIcons();
                        }
                    }, 50);
                };

                // --- localStorage Management ---
                // 使用 localStorage 儲存行前準備勾選狀態
                // 注意事項:
                // 1. localStorage 有容量限制 (通常 5-10MB)
                // 2. 僅儲存在同一瀏覽器、同一裝置上
                // 3. 清除瀏覽器資料會移除 localStorage
                // 4. 使用 JSON 格式儲存，確保資料結構化
                const STORAGE_KEY = '202602-hot-spring-checklist';

                const loadChecklistFromStorage = () => {
                    try {
                        const saved = localStorage.getItem(STORAGE_KEY);
                        if (saved) {
                            const savedData = JSON.parse(saved);
                            // Update checked states based on saved data
                            preparationItems.value.forEach(item => {
                                const savedItem = savedData.find(s => s.id === item.id);
                                if (savedItem) {
                                    item.checked = savedItem.checked;
                                }
                            });
                        }
                    } catch (error) {
                        console.error('Failed to load checklist from localStorage:', error);
                    }
                };

                const saveChecklistToStorage = () => {
                    try {
                        const dataToSave = preparationItems.value.map(item => ({
                            id: item.id,
                            checked: item.checked
                        }));
                        localStorage.setItem(STORAGE_KEY, JSON.stringify(dataToSave));
                    } catch (error) {
                        console.error('Failed to save checklist to localStorage:', error);
                    }
                };

                const toggleChecklistItem = (itemId) => {
                    const item = preparationItems.value.find(i => i.id === itemId);
                    if (item) {
                        item.checked = !item.checked;
                        saveChecklistToStorage();
                    }
                };

                // --- Auto Tab Switching Based on Date and Time ---
                const getCurrentTabBasedOnDateTime = () => {
                    const now = new Date();
                    const currentDate = new Date(now.getFullYear(), now.getMonth(), now.getDate());

                    // Find the appropriate tab based on current date
                    for (const tab of tabs) {
                        if (tab.date) {
                            const tabDate = new Date(tab.date);
                            if (currentDate.getTime() === tabDate.getTime()) {
                                return tab.id;
                            }
                        }
                    }

                    // If before first day, show day1
                    const firstDay = new Date('2026-02-01');
                    if (currentDate < firstDay) {
                        return 'day1';
                    }

                    // If after last day, show day3
                    const lastDay = new Date('2026-02-03');
                    if (currentDate > lastDay) {
                        return 'day3';
                    }

                    // Default to day1
                    return 'day1';
                };

                // Check if an event is expired (past)
                const isEventExpired = (dayId, eventTime) => {
                    const now = new Date();
                    const currentDate = new Date(now.getFullYear(), now.getMonth(), now.getDate());

                    // Find the date for this day
                    const tab = tabs.find(t => t.id === dayId);
                    if (!tab || !tab.date) return false;

                    const eventDate = new Date(tab.date);

                    // If event is on a past date, it's expired
                    if (eventDate < currentDate) {
                        return true;
                    }

                    // If event is today, check the time
                    if (eventDate.getTime() === currentDate.getTime()) {
                        // Extract hour from event time (e.g., "09:30" or "下午")
                        const timeMatch = eventTime.match(/(\d{1,2}):(\d{2})/);
                        if (timeMatch) {
                            const eventHour = parseInt(timeMatch[1]);
                            const eventMinute = parseInt(timeMatch[2]);
                            const eventDateTime = new Date(now);
                            eventDateTime.setHours(eventHour, eventMinute, 0, 0);

                            return now > eventDateTime;
                        }
                    }

                    return false;
                };

                // --- Watchers & Lifecycle ---
                watch(currentTab, async () => {
                    await nextTick();
                    // Scroll to top
                    if (mainContent.value) {
                        mainContent.value.scrollTop = 0;
                    }
                    // Clear expanded items when switching tabs
                    expandedExpiredItems.value.clear();
                    refreshIcons();
                });

                watch(isModalOpen, async (isOpen) => {
                    if (!isOpen) return;
                    await nextTick();
                    refreshIcons();
                });

                onMounted(() => {
                    loadChecklistFromStorage();
                    refreshIcons();

                    // Auto-switch to appropriate tab based on date/time
                    const autoTab = getCurrentTabBasedOnDateTime();
                    currentTab.value = autoTab;
                });

                return {
                    currentTab,
                    tabs,
                    currentData,
                    heroImage,
                    mainContent,
                    scheduleData,
                    isModalOpen,
                    selectedSpot,
                    googleMapLink,
                    openModal,
                    closeModal,
                    handleImageError,
                    handleHeroError,
                    preparationItems,
                    toggleChecklistItem,
                    isEventExpired,
                    expandedExpiredItems,
                    toggleExpiredItem,
                    isExpiredItemExpanded
                };
            }
        }).mount('#app');
    </script>
</body>

</html>